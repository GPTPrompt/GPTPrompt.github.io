---
title: "将复杂的任务拆分为更简单的子任务"
description: "将复杂的任务拆分为更简单的子任务"
---
import { Tabs } from 'nextra/components'

## 将复杂的任务拆分为更简单的子任务
正如软件工程中将复杂系统分解为一组模块化组件是良好实践一样，提交给语言模型的任务也是如此。 复杂的任务往往比简单的任务具有更高的错误率。 此外，复杂的任务通常可以被重新定义为更简单任务的工作流程，其中早期任务的输出用于构造后续任务的输入。

### 策略1:使用意图分类来识别与用户查询最相关的指令

对于需要大量独立指令集来处理不同情况的任务，首先对查询类型进行分类并使用该分类来确定需要哪些指令可能是有益的。 这可以通过定义与处理给定类别中的任务相关的固定类别和硬编码指令来实现。 该过程还可以递归地应用以将任务分解为一系列阶段。 这种方法的优点是每个查询仅包含执行任务下一阶段所需的指令，与使用单个查询执行整个任务相比，这可以降低错误率。 这还可以降低成本，因为较大的提示运行成本更高（请参阅定价信息）。

例如，假设对于客户服务应用程序，查询可以有效地分类如下：


<Tabs items={['角色: System', '角色: 用户']}>
  <Tabs.Tab>
  我们将向您提供客户服务查询。 将每个查询分为主要类别和次要类别。 提供 json 格式的输出，其中包含以下键：主要和次要。

  主要类别：计费、技术支持、帐户管理或一般查询。

    计费二级类别：
    - 取消订阅或升级
    - 添加付款方式
    - 收费说明
    - 对收费提出争议

    技术支持二级分类：
    - 故障排除
    - 设备兼容性
    - 软件更新

    账户管理二级分类：
    - 重设密码
    - 更新个人信息
    - 关闭账户
    - 账户安全

    一般查询二级类别：
    - 产品信息
    - 价钱
    - 反馈
    - 与人类交谈
  </Tabs.Tab>
  <Tabs.Tab>我需要让我的互联网重新工作。 </Tabs.Tab>
</Tabs>

根据客户查询的分类，可以向模型提供一组更具体的指令，以供其处理后续步骤。 例如，假设客户需要“故障排除”方面的帮助。

<Tabs items={['角色: System', '角色: 用户']}>
  <Tabs.Tab>
  您将收到需要在技术支持环境中进行故障排除的客户服务查询。 通过以下方式帮助用户：

  - 请他们检查所有进出路由器的电缆是否已连接。 请注意，随着时间的推移，电缆松动是很常见的。
  - 如果所有电缆均已连接并且问题仍然存在，请询问他们正在使用哪种路由器型号
  - 现在您将建议他们如何重新启动设备：    
  ++ 如果型号是 MTD-327J，建议他们按下红色按钮并按住 5 秒钟，然后等待 5 分钟后再测试连接。  
  ++ 如果型号是 MTD-327S，建议他们拔下并重新插入，然后等待 5 分钟再测试连接。  
  - 如果客户的问题在重新启动设备并等待 5 分钟后仍然存在，请通过输出 \{“IT 支持请求”\} 将他们连接到 IT 支持。
  - 如果用户开始询问与此主题无关的问题，请确认他们是否想结束当前有关故障排除的聊天，并根据以下方案对他们的请求进行分类：  
    
    
  {`<在此处插入上面的主要/次要分类方案>`}
  </Tabs.Tab>
  <Tabs.Tab>我需要让我的互联网重新工作。</Tabs.Tab>
</Tabs>

请注意，模型已被指示发出特殊字符串来指示对话状态何时发生变化。 这使我们能够将我们的系统变成一个状态机，其中状态决定注入哪些指令。 通过跟踪状态、哪些指令与该状态相关，以及可选地允许从该状态进行哪些状态转换，我们可以为用户体验设置护栏，而使用不太结构化的方法很难实现这一点。

### 策略2:对于需要很长对话的对话应用，总结或过滤以前的对话

由于模型具有固定的上下文长度，因此用户和助手之间的对话（其中整个对话都包含在上下文窗口中）无法无限期地继续。
解决此问题有多种解决方法，其中之一是总结对话中的先前回合。 一旦输入的大小达到预定的阈值长度，这可能会触发总结部分对话的查询，并且先前对话的摘要可以作为系统消息的一部分包括在内。 或者，可以在整个对话过程中在后台异步总结之前的对话。

另一种解决方案是动态选择与当前查询最相关的对话的先前部分。 请参阅策略“使用基于嵌入的搜索来实现高效的知识检索”。


### 策略3:分段总结长文档并递归构建完整摘要
由于模型具有固定的上下文长度，因此它们不能用于总结长于上下文长度减去单个查询中生成的摘要长度的文本。

要总结一个很长的文档（例如一本书），我们可以使用一系列查询来总结文档的每个部分。 章节摘要可以连接和总结，生成摘要的摘要。 这个过程可以递归地进行，直到总结整个文档。 如果有必要使用前面部分的信息来理解后面的部分，那么另一个有用的技巧是在书中任何给定点之前包含文本的运行摘要，同时总结该点的内容。 OpenAI 在之前的研究中已经使用 GPT-3 的变体研究了这种总结书籍的过程的有效性。
